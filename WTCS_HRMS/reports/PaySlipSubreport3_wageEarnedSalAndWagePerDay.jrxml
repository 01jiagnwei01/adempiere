<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: PaySlipSubreport3_wageEarnedSalAndWagePerDay.jrxml 1009 2012-02-09 09:16:13Z suman $ --> 
 <jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="PaySlipSubreport3_wageEarnedSalAndWagePerDay" pageWidth="535" pageHeight="802" columnWidth="535" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="HR_Process_ID" class="java.math.BigDecimal"/>
	<parameter name="C_BPartner_ID" class="java.math.BigDecimal"/>
	<queryString>
		<![CDATA[SELECT  cct.name  AS CategoryName,
cc.name AS ConceptName,
(CASE WHEN cct.columntype='A' Then round(COALESCE(hrm.amount,0),2) ELSE round(COALESCE(hrm.qty,0),2) END) AS amount,
emp.hasoptedpf,
hrm.HR_Process_ID,
(select round(COALESCE(sum(COALESCE(hrm1.amount,0)),2)) FROM HR_Movement hrm1 WHERE
(hrm1.HR_Concept_ID=hrm.HR_Concept_ID)
AND   (hrm1.C_BPartner_ID=hrm.C_BPartner_ID)
AND hrm1.HR_Concept_ID <> 9000005
AND   HR_Process_ID in ( select HR_Process_ID from HR_Process HRP
where HRP.hr_period_id in (select HR_Period_ID from HR_Period
where HR_Year_ID=(SELECT HR_Year_ID FROM HR_Period
WHERE HR_Period_ID=(SELECT HR_Period_ID FROM HR_Process
WHERE HR_Process_ID=$P{HR_Process_ID}
)
)
and PeriodNo<= ( select PeriodNo from HR_Period
where HR_Period_ID=(SELECT HR_Period_ID FROM HR_Process
WHERE HR_Process_ID=$P{HR_Process_ID}
) ) )
AND   HRP.payrollprocesstype= ( select payrollprocesstype from HR_Process where HR_Process_ID=$P{HR_Process_ID} )
)  ) AS YTD
FROM HR_Movement hrm
JOIN HR_Concept_Category cc ON (cc.HR_Concept_Category_ID = hrm.HR_Concept_Category_ID)
JOIN HR_Concept cct ON (cct.HR_Concept_ID = hrm.HR_Concept_ID)
JOIN C_BPartner cb ON hrm.C_BPartner_ID =cb.C_BPartner_ID
JOIN HR_Employee emp ON cb.C_BPartner_ID = emp.C_BPartner_ID
WHERE  hrm.C_BPartner_ID=$P{C_BPartner_ID} AND hrm.HR_PRocess_ID=$P{HR_Process_ID} AND
(hrm.HR_Concept_Category_ID =(SELECT HR_Concept_Category_ID FROM HR_Concept_Category hrcc WHERE hrcc.name='Wage Calculation' ))
AND (hrm.HR_Concept_ID IN (SELECT HR_Concept_ID FROM HR_Concept hrc WHERE
(hrc.name='Earned Salary' OR hrc.name='Present Days' OR (CASE WHEN cb.HR_Employee_Type_ID=1000001 THEN hrc.name='Wage Per Day'  END))
))]]>
	</queryString>
	<field name="categoryname" class="java.lang.String"/>
	<field name="conceptname" class="java.lang.String"/>
	<field name="amount" class="java.math.BigDecimal"/>
	<field name="hr_process_id" class="java.math.BigDecimal"/>
	<field name="ytd" class="java.math.BigDecimal"/>
	<field name="hasoptedpf" class="java.lang.Boolean"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="1" splitType="Stretch"/>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="49" splitType="Stretch">
			<crosstab>
				<reportElement key="crosstab-1" x="7" y="1" width="509" height="47"/>
				<crosstabHeaderCell>
					<cellContents mode="Transparent">
						<staticText>
							<reportElement key="staticText-1" x="1" y="4" width="92" height="13"/>
							<textElement textAlignment="Center" verticalAlignment="Bottom">
								<font isBold="true" pdfFontName="Helvetica-Bold"/>
							</textElement>
							<text><![CDATA[EARNINGS]]></text>
						</staticText>
						<line>
							<reportElement key="line-1" x="0" y="17" width="101" height="1"/>
						</line>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="categoryname" width="116" totalPosition="End">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{categoryname}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Transparent">
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="2" width="116" height="15"/>
								<textElement textAlignment="Left" verticalAlignment="Top"/>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{categoryname}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Transparent"/>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="conceptname" height="18" totalPosition="End" headerPosition="Center">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{conceptname}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Transparent">
							<line>
								<reportElement key="line-1" x="6" y="17" width="95" height="1"/>
							</line>
							<staticText>
								<reportElement key="staticText-1" x="6" y="0" width="95" height="16"/>
								<textElement verticalAlignment="Bottom">
									<font isBold="true" pdfFontName="Helvetica-Bold"/>
								</textElement>
								<text><![CDATA[CURRENT MONTH]]></text>
							</staticText>
							<staticText>
								<reportElement key="staticText-1" x="104" y="0" width="72" height="16"/>
								<textElement textAlignment="Right" verticalAlignment="Bottom">
									<font isBold="true" pdfFontName="Helvetica-Bold"/>
								</textElement>
								<text><![CDATA[YTD]]></text>
							</staticText>
							<line>
								<reportElement key="line-1" x="146" y="17" width="30" height="1"/>
							</line>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents/>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="GrossSalary" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{amount}]]></measureExpression>
				</measure>
				<measure name="GrossEarnings" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{amount}]]></measureExpression>
				</measure>
				<measure name="YTD" class="java.math.BigDecimal">
					<measureExpression><![CDATA[$F{ytd}]]></measureExpression>
				</measure>
				<measure name="YTDGross" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{ytd}]]></measureExpression>
				</measure>
				<crosstabCell width="177" height="17">
					<cellContents mode="Transparent">
						<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="2" width="95" height="15"/>
							<textElement textAlignment="Right" verticalAlignment="Top"/>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{GrossSalary}]]></textFieldExpression>
						</textField>
						<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="104" y="2" width="73" height="15">
								<printWhenExpression><![CDATA[$V{YTD}.compareTo(new BigDecimal(12)) <= 0 ? Boolean.FALSE : Boolean.TRUE]]></printWhenExpression>
							</reportElement>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font pdfFontName="Helvetica"/>
							</textElement>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{YTD}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="0" height="17" columnTotalGroup="conceptname">
					<cellContents mode="Transparent"/>
				</crosstabCell>
				<crosstabCell width="177" height="14" rowTotalGroup="categoryname">
					<cellContents mode="Transparent"/>
				</crosstabCell>
				<crosstabCell width="0" height="14" rowTotalGroup="categoryname" columnTotalGroup="conceptname">
					<cellContents mode="Transparent"/>
				</crosstabCell>
				<whenNoDataCell>
					<cellContents mode="Transparent"/>
				</whenNoDataCell>
			</crosstab>
		</band>
	</summary>
</jasperReport>
