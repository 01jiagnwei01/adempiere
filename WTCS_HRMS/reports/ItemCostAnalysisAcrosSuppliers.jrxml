<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: ItemCostAnalysisAcrosSuppliers.jrxml 1009 2012-02-09 09:16:13Z suman $ --> 
 <jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ItemCostAnalysisAcrosSuppliers" pageWidth="640" pageHeight="842" whenNoDataType="NoDataSection" columnWidth="560" leftMargin="30" rightMargin="50" topMargin="20" bottomMargin="20">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="M_Product_ID" class="java.math.BigDecimal"/>
	<parameter name="FromDate" class="java.sql.Timestamp"/>
	<parameter name="ToDate" class="java.sql.Timestamp"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String">
		<defaultValueExpression><![CDATA["./"]]></defaultValueExpression>
	</parameter>
	<parameter name="C_AcctSchema_ID" class="java.math.BigDecimal"/>
	<parameter name="AD_Org_ID" class="java.math.BigDecimal"/>
	<parameter name="AD_Client_ID" class="java.math.BigDecimal"/>
	<queryString>
		<![CDATA[SELECT  pro.name AS Product,cb.name AS Supplier , AVG(COALESCE(ivl.priceentered,0)) as avgPrice ,MIN(COALESCE(ivl.priceentered,0)) AS minPrice , MAX(COALESCE(ivl.priceentered,0)) AS maxPrice ,
  AVG(COALESCE(dd.CurrentCostPrice,0)) as avgAmount ,
  MIN(COALESCE(dd.CurrentCostPrice,0)) AS minAmount ,
  MAX(COALESCE(dd.CurrentCostPrice,0)) AS maxAmount

 FROM (SELECT SUM(cd.amt/cd.qty) AS CurrentCostPrice, cd.M_AttributeSetInstance_ID ,cd.c_orderline_Id
FROM
M_CostDetail cd
JOIN C_OrderLine cl ON ( cd.c_OrderlIne_ID=cl.C_OrderLine_ID)
JOIN C_Order c ON (cl.C_Order_ID=c.C_Order_ID)
JOIN C_AcctSchema ca ON (cd.C_AcctSchema_ID=ca.C_AcctSchema_ID)
JOIN M_Product p ON ( cd.M_Product_Id=p.M_Product_ID)
JOIN M_Product_Category_Acct pa ON (pa.M_Product_Category_Id=p.M_Product_Category_Id AND pa.C_AcctSchema_ID=ca.C_AcctSchema_ID)
WHERE c.issotrx='N'
 AND cd.M_Product_ID=$P!{M_Product_ID} and qty >0
AND (cd.dateacct BETWEEN '$P!{FromDate}' AND  '$P!{ToDate}' )
AND (cd.C_AcctSchema_ID = $P!{C_AcctSchema_ID} )
AND cd.M_Costtype_ID=ca.M_CostType_ID
  AND   ( CASE WHEN
pa.costingmethod IS NULL THEN
cd.costingmethod=ca.costingmethod
ELSE
cd.costingmethod=pa.CostingMethod END )
AND ( CASE WHEN  (CASE WHEN pa.CostingLevel IS NULL THEN
ca.costingLevel ELSE pa.CostingLevel END )  ='O' THEN cd.AD_Org_ID =$P!{AD_Org_ID}
ELSE pa.AD_Client_ID = $P!{AD_Client_ID} END )
GROUP   BY cd.M_AttributeSetInstance_ID ,cd.c_orderline_Id
ORDER  BY cd.M_AttributeSetInstance_ID
) dd
JOIN C_OrderLine col ON (dd.C_OrderLine_ID=col.C_OrderLine_ID)
 JOIN C_Order co ON co.C_Order_ID=col.C_Order_ID
 JOIN C_BPartner cb ON cb.C_BPartner_ID=col.C_BPartner_ID
 JOIN M_Product pro ON pro.M_Product_ID=col.M_Product_ID
 JOIN C_Invoice inv ON ( inv.C_Order_ID= co.C_Order_ID AND inv.C_BPartner_ID=cb.C_BPartner_ID  AND inv.C_BPartner_ID= cb.C_BPartner_ID )
 JOIN C_InvoiceLine ivl ON ivl.M_Product_ID=col.M_Product_ID AND ivl.M_Product_ID=pro.M_Product_ID  AND ivl.C_Invoice_ID=inv.C_Invoice_ID

WHERE
  co.isSOTrx='N'
  AND inv.docstatus IN ('CO','CL')

GROUP BY Supplier,Product]]>
	</queryString>
	<field name="product" class="java.lang.String"/>
	<field name="supplier" class="java.lang.String"/>
	<field name="avgprice" class="java.math.BigDecimal"/>
	<field name="minprice" class="java.math.BigDecimal"/>
	<field name="maxprice" class="java.math.BigDecimal"/>
	<field name="avgamount" class="java.math.BigDecimal"/>
	<field name="minamount" class="java.math.BigDecimal"/>
	<field name="maxamount" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="101" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-1" x="88" y="71" width="387" height="29"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="18" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Product Cost Analysis across suppliers]]></text>
			</staticText>
			<subreport>
				<reportElement x="0" y="0" width="560" height="60"/>
				<subreportParameter name="AD_Org_ID">
					<subreportParameterExpression><![CDATA[$P{AD_Org_ID}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression class="java.lang.String"><![CDATA[$P{SUBREPORT_DIR} + "clientaddress.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</title>
	<pageHeader>
		<band height="23" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-2" x="6" y="6" width="89" height="17"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Product Name]]></text>
			</staticText>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" x="95" y="6" width="100" height="17"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{product}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="39" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-3" x="1" y="1" width="202" height="38"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[SUPPLIER NAME ]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-4" x="203" y="1" width="178" height="18"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[RATE]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-5" x="203" y="19" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[AVG]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-6" x="263" y="19" width="58" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[MIN]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-7" x="321" y="19" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[MAX]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-8" x="381" y="1" width="176" height="18"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[ITEM COST]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-9" x="381" y="19" width="58" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[AVG]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-10" x="439" y="19" width="58" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[MIN]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-11" x="497" y="19" width="60" height="20"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[MAX]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="34" splitType="Stretch">
			<textField isBlankWhenNull="false">
				<reportElement key="textField" x="1" y="0" width="202" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{supplier}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="203" y="0" width="60" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{avgprice}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="263" y="0" width="58" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{minprice}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="321" y="0" width="60" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{maxprice}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="381" y="0" width="58" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{avgamount}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="439" y="0" width="58" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{minamount}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00" isBlankWhenNull="false">
				<reportElement key="textField" x="497" y="0" width="60" height="34"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid"/>
					<leftPen lineWidth="0.25" lineStyle="Solid"/>
					<bottomPen lineWidth="0.25" lineStyle="Solid"/>
					<rightPen lineWidth="0.25" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{maxamount}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="1" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
	<noData>
		<band height="51" splitType="Stretch">
			<staticText>
				<reportElement key="staticText-12" x="165" y="11" width="270" height="31"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[  "DATA NOT AVAILABLE "]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
