<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Migrations>
  <Migration EntityType="D" Name="ADEMPIERE-72 - Info Window Improvements " ReleaseNo="" SeqNo="812">
    <Comments>Adds messages and adjustments related to improvements to the info windows.</Comments>
    <Step SeqNo="10" StepType="AD">
      <Comments>Update the system configuration defaults to include INFO_AUTO_WILDCARD.</Comments>
      <PO AD_Table_ID="50009" Action="I" Record_ID="0" Table="AD_SysConfig">
        <Data AD_Column_ID="50188" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="50187" Column="AD_SysConfig_ID">50071</Data>
        <Data AD_Column_ID="50189" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="53271" Column="ConfigurationLevel">C</Data>
        <Data AD_Column_ID="50190" Column="Created">2012-04-23 13:39:31</Data>
        <Data AD_Column_ID="50192" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="50193" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="50197" Column="Description">Determines the wild card pattern to apply to search text as none, first, last or both.  The percent sign "%" is the wildcard.  The astrixs could be any text.  "*%" is the default - last only. * - is none.  %* is first only.  %*%, % or %% is both.</Data>
        <Data AD_Column_ID="50195" Column="Name">INFO_AUTO_WILDCARD</Data>
        <Data AD_Column_ID="50196" Column="Value">*%</Data>
        <Data AD_Column_ID="50191" Column="Updated">2012-04-23 13:39:31</Data>
        <Data AD_Column_ID="50194" Column="IsActive">true</Data>
        <Data AD_Column_ID="53270" Column="EntityType">D</Data>
      </PO>
    </Step>
    <Step SeqNo="20" StepType="AD">
      <Comments>Update the system configuration defaults to include INFO_AUTO_QUERY.</Comments>
      <PO AD_Table_ID="50009" Action="I" Record_ID="0" Table="AD_SysConfig">
        <Data AD_Column_ID="50189" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="50188" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="53271" Column="ConfigurationLevel">C</Data>
        <Data AD_Column_ID="50190" Column="Created">2012-04-23 13:35:17</Data>
        <Data AD_Column_ID="50192" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="50197" Column="Description">Info Windows - is the query performed automatically (Y) or does the user have to click the Refresh button.</Data>
        <Data AD_Column_ID="50195" Column="Name">INFO_AUTO_QUERY</Data>
        <Data AD_Column_ID="50191" Column="Updated">2012-04-23 13:35:17</Data>
        <Data AD_Column_ID="50193" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="50196" Column="Value">Y</Data>
        <Data AD_Column_ID="50187" Column="AD_SysConfig_ID">50072</Data>
        <Data AD_Column_ID="53270" Column="EntityType">D</Data>
        <Data AD_Column_ID="50194" Column="IsActive">true</Data>
      </PO>
    </Step>
    <Step SeqNo="30" StepType="AD">
      <Comments>Expected Change</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000000" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 08:51:14.108</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Expected Change</Data>
        <Data AD_Column_ID="199" Column="MsgTip">The expected change or delta in the amount.</Data>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 08:51:14.108</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">ExpectedChange</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53235</Data>
      </PO>
    </Step>
    <Step SeqNo="40" StepType="AD">
      <Comments>Only Stock</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000001" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:02:01.841</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53236</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Only Stock</Data>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:02:01.841</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">OnlyStock</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
      </PO>
    </Step>
    <Step SeqNo="50" StepType="AD">
      <Comments>OnlyStockTip</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000002" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:11:50.476</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">If selected, only display inventory items. Otherwise, display all products.</Data>
        <Data AD_Column_ID="199" Column="MsgTip">If selected, only display inventory items. Otherwise, display all products.</Data>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:11:50.476</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">OnlyStockTip</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53237</Data>
      </PO>
    </Step>
    <Step SeqNo="60" StepType="AD">
      <Comments>AutoRefresh</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000003" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:13:40.626</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Auto Refresh</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:13:40.626</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">AutoRefresh</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53238</Data>
      </PO>
    </Step>
    <Step SeqNo="70" StepType="AD">
      <Comments>ShowDetail</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000004" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:15:00.041</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Show Detail</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:15:00.041</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">ShowDetail</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53239</Data>
      </PO>
    </Step>
    <Step SeqNo="80" StepType="AD">
      <Comments>ShowAttributeDetails</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000005" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:17:41.327</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Show Attribute Details</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:17:41.327</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">ShowAttributeDetails</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53240</Data>
      </PO>
    </Step>
    <Step SeqNo="90" StepType="AD">
      <Comments>ContactAndAddress</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000006" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:18:59.4</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Contact and Address Information</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:18:59.4</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">ContactAndAddress</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53241</Data>
      </PO>
    </Step>
    <Step SeqNo="100" StepType="AD">
      <Comments>OnlyReceipt</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000007" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:21:14.632</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Only Receipts</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:21:14.632</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">OnlyReceipt</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53242</Data>
      </PO>
    </Step>
    <Step SeqNo="110" StepType="AD">
      <Comments>OnlyPayment</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000008" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:22:44.268</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Only AP Payments</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:22:44.268</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">OnlyPayment</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53243</Data>
      </PO>
    </Step>
    <Step SeqNo="120" StepType="AD">
      <Comments>Received</Comments>
      <PO AD_Table_ID="109" Action="I" Record_ID="1000009" Table="AD_Message">
        <Data AD_Column_ID="391" Column="AD_Client_ID">0</Data>
        <Data AD_Column_ID="392" Column="AD_Org_ID">0</Data>
        <Data AD_Column_ID="589" Column="Created">2013-09-14 09:26:20.706</Data>
        <Data AD_Column_ID="590" Column="CreatedBy">0</Data>
        <Data AD_Column_ID="7716" Column="EntityType">D</Data>
        <Data AD_Column_ID="588" Column="IsActive">true</Data>
        <Data AD_Column_ID="198" Column="MsgText">Received</Data>
        <Data AD_Column_ID="199" Column="MsgTip" isNewNull="true"/>
        <Data AD_Column_ID="197" Column="MsgType">I</Data>
        <Data AD_Column_ID="591" Column="Updated">2013-09-14 09:26:20.706</Data>
        <Data AD_Column_ID="592" Column="UpdatedBy">0</Data>
        <Data AD_Column_ID="6766" Column="Value">Received</Data>
        <Data AD_Column_ID="6765" Column="AD_Message_ID">53244</Data>
      </PO>
    </Step>
    <Step DBType="ALL" SeqNo="130" StepType="SQL">
      <Comments>Add M_Product_ID to M_Product_Stock_V </Comments>
      <SQLStatement>DROP VIEW adempiere.m_product_stock_v;

CREATE OR REPLACE VIEW adempiere.m_product_stock_v AS 
 SELECT ms.isactive, ms.created, ms.createdby, ms.updated, ms.updatedby, mp.m_product_id, mp.value, mp.help, ms.qtyonhand - ms.qtyreserved AS qtyavailable, ms.qtyonhand, ms.qtyreserved, mp.description, mw.name AS warehouse, mw.m_warehouse_id, mw.ad_client_id, mw.ad_org_id, mp.documentnote
   FROM adempiere.m_storage ms
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
  ORDER BY mw.name;

ALTER TABLE adempiere.m_product_stock_v
  OWNER TO adempiere;</SQLStatement>
      <RollbackStatement>DROP VIEW adempiere.m_product_stock_v;

CREATE OR REPLACE VIEW adempiere.m_product_stock_v AS 
 SELECT ms.isactive, ms.created, ms.createdby, ms.updated, ms.updatedby, mp.value, mp.help, ms.qtyonhand - ms.qtyreserved AS qtyavailable, ms.qtyonhand, ms.qtyreserved, mp.description, mw.name AS warehouse, mw.m_warehouse_id, mw.ad_client_id, mw.ad_org_id, mp.documentnote
   FROM adempiere.m_storage ms
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
  ORDER BY mw.name;

ALTER TABLE adempiere.m_product_stock_v
  OWNER TO adempiere;</RollbackStatement>
    </Step>
    <Step DBType="ALL" SeqNo="140" StepType="SQL">
      <Comments>Adding field description to the m_product_substituterelated_v view</Comments>
      <SQLStatement>DROP VIEW adempiere.m_product_substituterelated_v;

CREATE OR REPLACE VIEW adempiere.m_product_substituterelated_v AS 
         SELECT s.ad_client_id, s.ad_org_id, s.isactive, s.created, s.createdby, s.updated, s.updatedby, s.m_product_id, s.substitute_id, s.name AS description, 'S'::text AS rowtype, mp.value, mp.name, sum(ms.qtyonhand - ms.qtyreserved) AS qtyavailable, sum(ms.qtyonhand) AS qtyonhand, sum(ms.qtyreserved) AS qtyreserved, round(max(mpr.pricestd), 0) AS pricestd, mpr.m_pricelist_version_id, mw.m_warehouse_id, org.name AS orgname
           FROM adempiere.m_substitute s
      JOIN adempiere.m_storage ms ON ms.m_product_id = s.substitute_id
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
   JOIN adempiere.m_productprice mpr ON ms.m_product_id = mpr.m_product_id
   JOIN adempiere.ad_org org ON org.ad_org_id = mw.ad_org_id
  GROUP BY s.ad_client_id, s.ad_org_id, s.isactive, s.created, s.createdby, s.updated, s.updatedby, s.m_product_id, s.substitute_id, s.name, mp.value, mw.m_warehouse_id, mpr.m_pricelist_version_id, org.name, mp.name
UNION 
         SELECT r.ad_client_id, r.ad_org_id, r.isactive, r.created, r.createdby, r.updated, r.updatedby, r.m_product_id, r.relatedproduct_id AS substitute_id, r.name AS description, 'R'::text AS rowtype, mp.value, mp.name, sum(ms.qtyonhand - ms.qtyreserved) AS qtyavailable, sum(ms.qtyonhand) AS qtyonhand, sum(ms.qtyreserved) AS qtyreserved, round(max(mpr.pricestd), 0) AS pricestd, mpr.m_pricelist_version_id, mw.m_warehouse_id, org.name AS orgname
           FROM adempiere.m_relatedproduct r
      JOIN adempiere.m_storage ms ON ms.m_product_id = r.relatedproduct_id
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
   JOIN adempiere.m_productprice mpr ON ms.m_product_id = mpr.m_product_id
   JOIN adempiere.ad_org org ON org.ad_org_id = mw.ad_org_id
  GROUP BY r.ad_client_id, r.ad_org_id, r.isactive, r.created, r.createdby, r.updated, r.updatedby, r.m_product_id, r.relatedproduct_id, r.name, mw.m_warehouse_id, mpr.m_pricelist_version_id, org.name, mp.value, mp.name;

ALTER TABLE adempiere.m_product_substituterelated_v
  OWNER TO adempiere;</SQLStatement>
      <RollbackStatement>DROP VIEW adempiere.m_product_substituterelated_v;

CREATE OR REPLACE VIEW adempiere.m_product_substituterelated_v AS 
         SELECT s.ad_client_id, s.ad_org_id, s.isactive, s.created, s.createdby, s.updated, s.updatedby, s.m_product_id, s.substitute_id, 'S'::text AS rowtype, mp.name, sum(ms.qtyonhand - ms.qtyreserved) AS qtyavailable, sum(ms.qtyonhand) AS qtyonhand, sum(ms.qtyreserved) AS qtyreserved, round(max(mpr.pricestd), 0) AS pricestd, mpr.m_pricelist_version_id, mw.m_warehouse_id, org.name AS orgname
           FROM adempiere.m_substitute s
      JOIN adempiere.m_storage ms ON ms.m_product_id = s.substitute_id
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
   JOIN adempiere.m_productprice mpr ON ms.m_product_id = mpr.m_product_id
   JOIN adempiere.ad_org org ON org.ad_org_id = mw.ad_org_id
  GROUP BY s.ad_client_id, s.ad_org_id, s.isactive, s.created, s.createdby, s.updated, s.updatedby, s.m_product_id, s.substitute_id, mw.m_warehouse_id, mpr.m_pricelist_version_id, org.name, mp.name
UNION 
         SELECT r.ad_client_id, r.ad_org_id, r.isactive, r.created, r.createdby, r.updated, r.updatedby, r.m_product_id, r.relatedproduct_id AS substitute_id, 'R'::text AS rowtype, mp.name, sum(ms.qtyonhand - ms.qtyreserved) AS qtyavailable, sum(ms.qtyonhand) AS qtyonhand, sum(ms.qtyreserved) AS qtyreserved, round(max(mpr.pricestd), 0) AS pricestd, mpr.m_pricelist_version_id, mw.m_warehouse_id, org.name AS orgname
           FROM adempiere.m_relatedproduct r
      JOIN adempiere.m_storage ms ON ms.m_product_id = r.relatedproduct_id
   JOIN adempiere.m_product mp ON ms.m_product_id = mp.m_product_id
   JOIN adempiere.m_locator ml ON ms.m_locator_id = ml.m_locator_id
   JOIN adempiere.m_warehouse mw ON ml.m_warehouse_id = mw.m_warehouse_id
   JOIN adempiere.m_productprice mpr ON ms.m_product_id = mpr.m_product_id
   JOIN adempiere.ad_org org ON org.ad_org_id = mw.ad_org_id
  GROUP BY r.ad_client_id, r.ad_org_id, r.isactive, r.created, r.createdby, r.updated, r.updatedby, r.m_product_id, r.relatedproduct_id, mw.m_warehouse_id, mpr.m_pricelist_version_id, org.name, mp.name;

ALTER TABLE adempiere.m_product_substituterelated_v
  OWNER TO adempiere;</RollbackStatement>
    </Step>
    <Step DBType="ALL" SeqNo="150" StepType="SQL">
      <Comments>Fix display of dates in the product attributes</Comments>
      <SQLStatement>-- Function: adempiere.productattribute(numeric)

-- DROP FUNCTION adempiere.productattribute(numeric);

CREATE OR REPLACE FUNCTION adempiere.productattribute(p_m_attributesetinstance_id numeric)
  RETURNS character varying AS
$BODY$

/*************************************************************************
 * The contents of this file are subject to the Compiere License.  You may
 * obtain a copy of the License at    http://www.compiere.org/license.html 
 * Software is on an  "AS IS" basis,  WITHOUT WARRANTY OF ANY KIND, either 
 * express or implied. See the License for details. Code: Compiere ERP+CRM
 * Copyright (C) 1999-2001 Jorg Janke, ComPiere, Inc. All Rights Reserved.
 *
 * converted to postgreSQL by Karsten Thiemann (Schaeffer AG), 
 * kthiemann@adempiere.org
 * 
 * Format v_GuaranteeDate as date 
 *************************************************************************
 * Title: Return Instance Attribute Info
 * Description:
 *  
 * Test:
    SELECT ProductAttribute (M_AttributeSetInstance_ID) 
    FROM M_InOutLine WHERE M_AttributeSetInstance_ID &gt; 0
    --
    SELECT p.Name
    FROM C_InvoiceLine il LEFT OUTER JOIN M_Product p ON (il.M_Product_ID=p.M_Product_ID);
    SELECT p.Name || ProductAttribute (il.M_AttributeSetInstance_ID) 
    FROM C_InvoiceLine il LEFT OUTER JOIN M_Product p ON (il.M_Product_ID=p.M_Product_ID);
    
 ************************************************************************/

	
DECLARE

    v_Name          VARCHAR(2000) := '';
    v_NameAdd       VARCHAR(2000) := '';
    --
    v_Lot           M_AttributeSetInstance.Lot%TYPE;
    v_LotStart      M_AttributeSet.LotCharSOverwrite%TYPE;
    v_LotEnd        M_AttributeSet.LotCharEOverwrite%TYPE;
    v_SerNo         M_AttributeSetInstance.SerNo%TYPE;
    v_SerNoStart    M_AttributeSet.SerNoCharSOverwrite%TYPE;
    v_SerNoEnd      M_AttributeSet.SerNoCharEOverwrite%TYPE;
    v_GuaranteeDate M_AttributeSetInstance.GuaranteeDate%TYPE;
    
    r   RECORD;
    --

BEGIN
    --  Get Product Attribute Set Instance
    IF (p_M_AttributeSetInstance_ID &gt; 0) THEN
        SELECT asi.Lot, asi.SerNo, asi.GuaranteeDate,
            COALESCE(a.SerNoCharSOverwrite, '#'::CHAR(1)), COALESCE(a.SerNoCharEOverwrite, ''::CHAR(1)),
            COALESCE(a.LotCharSOverwrite, '«'::CHAR(1)), COALESCE(a.LotCharEOverwrite, '»'::CHAR(1))
          INTO v_Lot, v_SerNo, v_GuaranteeDate,
            v_SerNoStart, v_SerNoEnd, v_LotStart, v_LotEnd
        FROM M_AttributeSetInstance asi
          INNER JOIN M_AttributeSet a ON (asi.M_AttributeSet_ID=a.M_AttributeSet_ID)
        WHERE asi.M_AttributeSetInstance_ID=p_M_AttributeSetInstance_ID;
        --
        IF (v_SerNo IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || v_SerNoStart || v_SerNo || v_SerNoEnd || ' ';
        END IF;
        IF (v_Lot IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || v_LotStart || v_Lot || v_LotEnd || ' ';
        END IF;
        IF (v_GuaranteeDate IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || CAST(v_GuaranteeDate AS DATE) || ' ';
        END IF;
        --
        
        FOR r IN
	     SELECT ai.Value, a.Name
	        FROM M_AttributeInstance ai
	        INNER JOIN M_Attribute a ON (ai.M_Attribute_ID=a.M_Attribute_ID AND a.IsInstanceAttribute='Y')
        	WHERE ai.M_AttributeSetInstance_ID=p_M_AttributeSetInstance_ID
    	LOOP
            v_NameAdd := v_NameAdd || r.Name || ':' || r.Value || ' ';
        END LOOP;
        --
        IF (LENGTH(v_NameAdd) &gt; 0) THEN
            v_Name := v_Name || ' (' || TRIM(v_NameAdd) || ')';
	ELSE 
	    v_Name := NULL;
        END IF;
    END IF;
    RETURN v_Name;
END;

$BODY$
  LANGUAGE plpgsql VOLATILE
  COST 100;
ALTER FUNCTION adempiere.productattribute(numeric)
  OWNER TO adempiere;
</SQLStatement>
      <RollbackStatement>-- Function: adempiere.productattribute(numeric)

-- DROP FUNCTION adempiere.productattribute(numeric);

CREATE OR REPLACE FUNCTION adempiere.productattribute(p_m_attributesetinstance_id numeric)
  RETURNS character varying AS
$BODY$

/*************************************************************************
 * The contents of this file are subject to the Compiere License.  You may
 * obtain a copy of the License at    http://www.compiere.org/license.html 
 * Software is on an  "AS IS" basis,  WITHOUT WARRANTY OF ANY KIND, either 
 * express or implied. See the License for details. Code: Compiere ERP+CRM
 * Copyright (C) 1999-2001 Jorg Janke, ComPiere, Inc. All Rights Reserved.
 *
 * converted to postgreSQL by Karsten Thiemann (Schaeffer AG), 
 * kthiemann@adempiere.org
 *************************************************************************
 * Title: Return Instance Attribute Info
 * Description:
 *  
 * Test:
    SELECT ProductAttribute (M_AttributeSetInstance_ID) 
    FROM M_InOutLine WHERE M_AttributeSetInstance_ID &gt; 0
    --
    SELECT p.Name
    FROM C_InvoiceLine il LEFT OUTER JOIN M_Product p ON (il.M_Product_ID=p.M_Product_ID);
    SELECT p.Name || ProductAttribute (il.M_AttributeSetInstance_ID) 
    FROM C_InvoiceLine il LEFT OUTER JOIN M_Product p ON (il.M_Product_ID=p.M_Product_ID);
    
 ************************************************************************/

	
DECLARE

    v_Name          VARCHAR(2000) := '';
    v_NameAdd       VARCHAR(2000) := '';
    --
    v_Lot           M_AttributeSetInstance.Lot%TYPE;
    v_LotStart      M_AttributeSet.LotCharSOverwrite%TYPE;
    v_LotEnd        M_AttributeSet.LotCharEOverwrite%TYPE;
    v_SerNo         M_AttributeSetInstance.SerNo%TYPE;
    v_SerNoStart    M_AttributeSet.SerNoCharSOverwrite%TYPE;
    v_SerNoEnd      M_AttributeSet.SerNoCharEOverwrite%TYPE;
    v_GuaranteeDate M_AttributeSetInstance.GuaranteeDate%TYPE;
    
    r   RECORD;
    --

BEGIN
    --  Get Product Attribute Set Instance
    IF (p_M_AttributeSetInstance_ID &gt; 0) THEN
        SELECT asi.Lot, asi.SerNo, asi.GuaranteeDate,
            COALESCE(a.SerNoCharSOverwrite, '#'::CHAR(1)), COALESCE(a.SerNoCharEOverwrite, ''::CHAR(1)),
            COALESCE(a.LotCharSOverwrite, '«'::CHAR(1)), COALESCE(a.LotCharEOverwrite, '»'::CHAR(1))
          INTO v_Lot, v_SerNo, v_GuaranteeDate,
            v_SerNoStart, v_SerNoEnd, v_LotStart, v_LotEnd
        FROM M_AttributeSetInstance asi
          INNER JOIN M_AttributeSet a ON (asi.M_AttributeSet_ID=a.M_AttributeSet_ID)
        WHERE asi.M_AttributeSetInstance_ID=p_M_AttributeSetInstance_ID;
        --
        IF (v_SerNo IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || v_SerNoStart || v_SerNo || v_SerNoEnd || ' ';
        END IF;
        IF (v_Lot IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || v_LotStart || v_Lot || v_LotEnd || ' ';
        END IF;
        IF (v_GuaranteeDate IS NOT NULL) THEN
            v_NameAdd := v_NameAdd || v_GuaranteeDate || ' ';
        END IF;
        --
        
        FOR r IN
	     SELECT ai.Value, a.Name
	        FROM M_AttributeInstance ai
	        INNER JOIN M_Attribute a ON (ai.M_Attribute_ID=a.M_Attribute_ID AND a.IsInstanceAttribute='Y')
        	WHERE ai.M_AttributeSetInstance_ID=p_M_AttributeSetInstance_ID
    	LOOP
            v_NameAdd := v_NameAdd || r.Name || ':' || r.Value || ' ';
        END LOOP;
        --
        IF (LENGTH(v_NameAdd) &gt; 0) THEN
            v_Name := v_Name || ' (' || TRIM(v_NameAdd) || ')';
	ELSE 
	    v_Name := NULL;
        END IF;
    END IF;
    RETURN v_Name;
END;

$BODY$
  LANGUAGE plpgsql VOLATILE
  COST 100;
ALTER FUNCTION adempiere.productattribute(numeric)
  OWNER TO adempiere;
</RollbackStatement>
    </Step>
  </Migration>
</Migrations>
